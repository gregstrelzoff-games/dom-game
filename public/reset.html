
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Set password Â· v1.1.0</title>
  <link rel="stylesheet" href="/theme.css" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/game-theme.css" />
</head>
<body>
  <div class="container narrow">
    <h1>Set your password</h1>
    <form id="form">
      <label>New password <input id="pw1" type="password" minlength="8" required /></label>
      <label>Confirm password <input id="pw2" type="password" minlength="8" required /></label>
      <div class="actions"><button type="submit" class="btn btn-primary">Save password</button></div>
    </form>
    <div id="status" class="muted"></div>
  </div>
  <script>
    const $ = s => document.querySelector(s);
    const params = new URLSearchParams(location.search);
    const token = params.get("token");
    $("#form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const a = $("#pw1").value, b = $("#pw2").value;
      if (a.length < 8) return alert("Password must be at least 8 characters.");
      if (a !== b) return alert("Passwords do not match.");
      try{
        const res = await fetch("/api/auth/set-password", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ token, password: a })
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.error || "Failed to set password");
        $("#status").textContent = "Password saved. You can close this tab.";
        $("#form").classList.add("hidden");
      }catch(e){
        $("#status").textContent = e.message;
      }
    });
  </script>
</body>
</html>
